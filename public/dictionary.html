<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Мій Словник</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    .hero-section {
      background: linear-gradient(135deg, #6f42c1 0%, #a06ee1 100%); /* Фіолетовий градієнт для словника */
      color: white;
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .table-hover tbody tr:hover {
      background-color: #f8f9fa;
      cursor: default;
    }
    .pos-badge {
      font-size: 0.85em;
      font-weight: 500;
    }
  </style>
</head>
<body class="bg-light">

  <!-- Навігація -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
      <a class="navbar-brand" href="/">
        <i class="bi bi-heart-pulse-fill text-danger me-2"></i>Medical English App
      </a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="/">Головна</a>
        <a class="nav-link active" href="/dictionary.html">Словник</a>
      </div>
    </div>
  </nav>

  <div class="container" style="max-width: 1000px;">

    <!-- Hero Section -->
    <div class="hero-section shadow-sm text-center">
      <h2 class="fw-bold mb-2"><i class="bi bi-book-half me-2"></i>Повний Словник</h2>
      <p class="mb-0 opacity-75">Вся ваша збережена лексика в одному місці.</p>
    </div>

    <!-- Панель управління (Фільтр) -->
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-md-6">
            <label for="posFilter" class="form-label fw-bold text-muted small text-uppercase">
              <i class="bi bi-funnel me-1"></i> Фільтрувати за частиною мови
            </label>
            <select id="posFilter" class="form-select form-select-lg border-2">
              <option value="all" selected>Всі слова</option>
              <option value="Noun">Іменник (Noun)</option>
              <option value="Verb">Дієслово (Verb)</option>
              <option value="Adjective">Прикметник (Adjective)</option>
              <option value="Adverb">Прислівник (Adverb)</option>
              <option value="Phrase/Other">Фрази та інше</option>
            </select>
          </div>
          <div class="col-md-6 text-md-end mt-3 mt-md-0">
             <span class="text-muted small">Знайдено слів: <span id="total-words-count" class="fw-bold text-dark">...</span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Таблиця -->
    <div class="card shadow-sm border-0 overflow-hidden mb-4">
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th scope="col" class="ps-4 py-3 text-uppercase small text-muted" style="width: 35%;">English</th>
              <th scope="col" class="py-3 text-uppercase small text-muted" style="width: 35%;">Ukrainian</th>
              <th scope="col" class="pe-4 py-3 text-uppercase small text-muted text-end" style="width: 30%;">Part of Speech</th>
            </tr>
          </thead>
          <tbody id="dictionary-table-body" class="bg-white">
            <!-- Сюди JS вставить рядки -->
            <tr><td colspan="3" class="text-center py-5 text-muted">Завантаження...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Пагінація -->
    <nav aria-label="Сторінки словника" class="pb-5">
      <ul class="pagination justify-content-center pagination-lg" id="pagination-container">
        <!-- Кнопки генеруються JS -->
      </ul>
    </nav>

  </div>

  <script>
    // Логіка Словника (Dictionary JS)
    // Ми залишаємо її тут, всередині файлу, щоб не створювати зайвий файл
    
    let currentPage = 1;
    let currentPosFilter = 'all';
    const wordsPerPage = 15; // Трохи більше слів на сторінку

    const tableBody = document.getElementById('dictionary-table-body');
    const paginationContainer = document.getElementById('pagination-container');
    const posFilter = document.getElementById('posFilter');
    const totalCountSpan = document.getElementById('total-words-count');

    async function fetchAndRenderWords() {
      tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-5"><div class="spinner-border text-primary"></div></td></tr>';
      
      try {
        const response = await fetch(`/api/all-words?page=${currentPage}&limit=${wordsPerPage}&pos=${currentPosFilter}`);
        if (!response.ok) throw new Error('Помилка завантаження');
        
        const data = await response.json();
        
        renderTable(data.words);
        renderPagination(data.pagination);
        
        if(data.pagination && data.pagination.totalWords) {
             totalCountSpan.textContent = data.pagination.totalWords;
        }

      } catch (error) {
        console.error('Помилка:', error);
        tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-4 text-danger"><i class="bi bi-exclamation-triangle me-2"></i>Не вдалося завантажити словник.</td></tr>';
      }
    }

    function renderTable(words) {
      tableBody.innerHTML = ''; 
      if (words.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-5 text-muted">Слів не знайдено.</td></tr>';
        return;
      }
      
      words.forEach(word => {
        // Визначаємо колір бейджика для частини мови
        let badgeClass = 'bg-secondary';
        if (word.part_of_speech === 'Noun') badgeClass = 'bg-primary';
        if (word.part_of_speech === 'Verb') badgeClass = 'bg-success';
        if (word.part_of_speech === 'Adjective') badgeClass = 'bg-info text-dark';

        const row = `
          <tr>
            <td class="ps-4 fw-bold text-primary">${word.english}</td>
            <td>${word.ukrainian}</td>
            <td class="pe-4 text-end"><span class="badge ${badgeClass} pos-badge rounded-pill px-3 py-2">${word.part_of_speech}</span></td>
          </tr>
        `;
        tableBody.innerHTML += row;
      });
    }

    function renderPagination(pagination) {
      paginationContainer.innerHTML = '';
      const { currentPage, totalPages } = pagination;
      if (totalPages <= 1) return;

      // Назад
      const prevDisabled = currentPage === 1 ? 'disabled' : '';
      paginationContainer.innerHTML += `
        <li class="page-item ${prevDisabled}">
          <a class="page-link border-0 shadow-sm me-2" href="#" data-page="${currentPage - 1}"><i class="bi bi-chevron-left"></i></a>
        </li>
      `;

      // Номери (спрощена логіка для краси)
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, currentPage + 2);

      if (startPage > 1) paginationContainer.innerHTML += `<li class="page-item disabled"><span class="page-link border-0 bg-transparent">...</span></li>`;

      for (let i = startPage; i <= endPage; i++) {
        const activeClass = i === currentPage ? 'active' : '';
        paginationContainer.innerHTML += `
          <li class="page-item ${activeClass}">
            <a class="page-link border-0 shadow-sm mx-1 rounded-circle text-center" style="width: 45px; height: 45px; line-height: 30px;" href="#" data-page="${i}">${i}</a>
          </li>
        `;
      }

      if (endPage < totalPages) paginationContainer.innerHTML += `<li class="page-item disabled"><span class="page-link border-0 bg-transparent">...</span></li>`;

      // Вперед
      const nextDisabled = currentPage === totalPages ? 'disabled' : '';
      paginationContainer.innerHTML += `
        <li class="page-item ${nextDisabled}">
          <a class="page-link border-0 shadow-sm ms-2" href="#" data-page="${currentPage + 1}"><i class="bi bi-chevron-right"></i></a>
        </li>
      `;
    }

    // Події
    document.addEventListener('DOMContentLoaded', fetchAndRenderWords);
    
    posFilter.addEventListener('change', (e) => {
      currentPosFilter = e.target.value;
      currentPage = 1;
      fetchAndRenderWords();
    });

    paginationContainer.addEventListener('click', (e) => {
      e.preventDefault();
      // Шукаємо клік по посиланню або іконці всередині посилання
      const targetLink = e.target.closest('a');
      if (targetLink && targetLink.dataset.page) {
        const page = parseInt(targetLink.dataset.page, 10);
        if (page !== currentPage && page > 0) {
          currentPage = page;
          fetchAndRenderWords();
          window.scrollTo({ top: 0, behavior: 'smooth' }); // Скрол вгору
        }
      }
    });

  </script>
</body>
</html>